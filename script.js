const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let e = []; // trails
let h = []; // heart path
let O = canvas.width = innerWidth;
let Q = canvas.height = innerHeight;

const v = 32; // num trails, num particles per trail & num nodes in heart path
const M = Math;
const R = M.random;
const C = M.cos;
const Y = 6.3; // close to 44/7 or Math.PI * 2 - 6.3 seems is close enough.

const textArray = [
  "–ú–∞—à—É–ª—è", "–ü—Ä—ñ–≤—î—Ç‚ù§Ô∏è", "–•–æ—á—É", "–¢–æ–±—ñ", "–ù–∞–≥–∞–¥–∞—Ç–∏", "–©–æ...", "–¢–∏",
  "–ù–∞–π–∫—Ä–∞—â–∞ –¥—ñ–≤—á–∏–Ω–∞ —É —Å–≤—ñ—Ç—ñ", "–Ø —Ü—ñ–Ω—É—é –∫–æ–∂–Ω—É –º–∏—Ç—å, –ø—Ä–æ–≤–µ–¥–µ–Ω—É –∑ —Ç–æ–±–æ—é",
  "–¢–∏ ‚Äì –º–æ—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —ñ –æ–ø–æ—Ä–∞", "–¢–∏ —Ä–æ–±–∏—à –º–µ–Ω–µ –∫—Ä–∞—â–∏–º", "–¢–∏ –º–æ—î —Å–æ–Ω–µ—á–∫–æ",
  "–¢–∏ –º—ñ–π —Å–ø–æ–∫—ñ–π", "–¢–∏ –º—ñ–π –¥—ñ–º", "–¢–∏ –∑–∞–≤–∂–¥–∏ —á–∞—Ä—ñ–≤–Ω–∞", "–Ø –Ω–µ –º–æ–∂—É —É—è–≤–∏—Ç–∏ —Å–≤–æ—î –∂–∏—Ç—Ç—è –±–µ–∑ —Ç–µ–±–µ", "–Ø –ø–∏—à–∞—é—Å—å —Ç–æ–±–æ—é",
  "–Ø –ª—é–±–ª—é —Ç–µ–±–µ —Ç–∞–∫–æ—é, —è–∫–∞ —Ç–∏ —î", "–ê", "–©–µ", "–¢–∏", "–ß–∞—Ä—ñ–≤–Ω–∞ ‚ú®", "–ù–µ–ø–æ–≤—Ç–æ—Ä–Ω–∞ üíñ", "–î–∏–≤–æ–≤–∏–∂–Ω–∞ üí´", "–ù—ñ–∂–Ω–∞ üå∏",
  "–ù–µ–∑—Ä—ñ–≤–Ω—è–Ω–Ω–∞ üåü", "–ö–∞–∑–∫–æ–≤–∞ üßö‚Äç‚ôÄÔ∏è", "–ó–∞—Ö–æ–ø–ª—é—é—á–∞ üíï", "–°—Ç–∏–ª—å–Ω–∞ ‚ú®", "–í–∏—Ç–æ–Ω—á–µ–Ω–∞  üå∏", "–†–æ–∑–∫—ñ—à–Ω–∞ üëë", "–ö—Ä–∞—Å–∏–≤–∞ üíê",
  "–õ–∞–≥—ñ–¥–Ω–∞ ‚òÄÔ∏è", "–°–ø–æ–∫—É—Å–ª–∏–≤–∞ üî•", "–ö—Ä–∞—â–∞ –Ω—ñ–∂ –Ü—Ä–∞ üéÄ", "–ù–µ–ø–µ—Ä–µ–≤–µ—Ä—à–µ–Ω–∞ üíé", "–ì–µ–Ω—ñ–∞–ª—å–Ω–∞ üß†", "–ú–∏–ª–æ–∑–≤—É—á–Ω–∞ üé∂", "–í—ñ—Ä–Ω–∞ ‚ù§Ô∏è",
  "–í—Ä–æ–¥–ª–∏–≤–∞ üåπ", "–ü—Ä–µ–∫—Ä–∞—Å–Ω–∞ üå∫", "–£–Ω—ñ–∫–∞–ª—å–Ω–∞ üíé", "–ù–µ–ø—ñ–¥—Ä–æ–±–Ω–∞ ü§ó", "–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞ ‚ú®", "–Ø –≤–¥—è—á–Ω–∏–π ", "–î–æ–ª—ñ", "–©–æ",
  "–ü–æ–¥–∞—Ä—É–≤–∞–ª–∞", "–ú–µ–Ω—ñ", "–¢–µ–±–µ", "–Ø", "–¢–ï–ë–ï", "–î–£–ñ–ï", "–õ–Æ–ë–õ–Æ", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è"
  , "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è"
  , "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è"
  , "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è"
  , "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è"
  , "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è"
  , "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è"
];

// –ù–æ–≤–∏–π —Å–ø–∏—Å–æ–∫ —Å–ª—ñ–≤, –∑ —è–∫–æ–≥–æ –≤–∏–±–∏—Ä–∞—Ç–∏–º—É—Ç—å—Å—è —Å–ª–æ–≤–∞ –ø—ñ—Å–ª—è "–õ–Æ–ë–õ–Æ"
const alternateTextArray = [
  "–¢–∏ –Ω–µ–ø–æ–≤—Ç–æ—Ä–Ω–∞", "–¢–∏ –º–æ—î –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è", "–¢–∏ –∑—ñ—Ä–∫–∞", "–Ø –≥–æ—Ä–¥–∂—É—Å—è —Ç–æ–±–æ—é", "–¢–∏ –º–æ—è —Ä–∞–¥—ñ—Å—Ç—å", "–¢–∏ - –º–æ—î –≤—Å–µ"
];

// –ú–∞—Å–∏–≤ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –∞–Ω—ñ–º–æ–≤–∞–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç—É
let animatedTexts = [];
let textIndex = 0; // –Ü–Ω–¥–µ–∫—Å –¥–ª—è –≤–∏–±–æ—Ä—É —Ç–µ–∫—Å—Ç—É –ø–æ –ø–æ—Ä—è–¥–∫—É
let alternateTextIndex = 0; // –Ü–Ω–¥–µ–∫—Å –¥–ª—è –≤–∏–±–æ—Ä—É —Ç–µ–∫—Å—Ç—É –∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É
function createText(x, y, text) {
  return {
    x: x,
    y: y,
    text: text,
    alpha: 1, // –ü–æ—á–∞—Ç–∫–æ–≤–∞ –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å (–ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–¥–∏–º–∏–π)
    speedX: R() * 1 - 1, // –®–≤–∏–¥–∫—ñ—Å—Ç—å —Ä—É—Ö—É –ø–æ X
    speedY: R() * 1 - 1, // –®–≤–∏–¥–∫—ñ—Å—Ç—å —Ä—É—Ö—É –ø–æ Y
    fadeSpeed: 0.005 + R() * 0.001
  };
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É
function renderText(animatedText) {
  ctx.fillStyle = `rgba(255, 255, 255, ${animatedText.alpha})`;
  ctx.font = "18px Arial"; // –ó–±—ñ–ª—å—à–µ–Ω–æ —à—Ä–∏—Ñ—Ç
  ctx.fillText(animatedText.text, animatedText.x, animatedText.y);
}

// –§–æ—Ä–º—É–≤–∞–Ω–Ω—è —à–ª—è—Ö—É —Å–µ—Ä—Ü—è
for (let i = 0; i < Y; i += 0.2) {
  h.push([
    O / 2 + 180 * M.pow(M.sin(i), 3),
    Q / 2 + 10 * (-(15 * C(i) - 5 * C(2 * i) - 2 * C(3 * i) - C(4 * i)))
  ]);
}

let i = 0;
while (i < v) {
  const x = R() * O;
  const y = R() * Q;

  const H = i / v * 80 + 280;
  const S = R() * 40 + 60;
  const B = R() * 60 + 20;

  let f = [];

  let k = 0;
  while (k < v) {
    f[k++] = {
      x: x,
      y: y,
      X: 0,
      Y: 0,
      R: (1 - k / v) + 1,
      S: R() + 1,
      q: ~~(R() * v),
      D: i % 2 * 2 - 1,
      F: R() * 0.2 + 0.7,
      f: `hsla(${~~H},${~~S}%,${~~B}%,.1)`
    };
  }

  e[i++] = f;
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è —á–∞—Å—Ç–∏–Ω–∫–∏
function render(_) {
  ctx.fillStyle = _.f;
  ctx.beginPath();
  ctx.arc(_.x, _.y, _.R, 0, Y, 1);
  ctx.closePath();
  ctx.fill();
}

function loop() {
  ctx.fillStyle = "rgba(0,0,0,.4)";
  ctx.fillRect(0, 0, O, Q);

  let i = v;
  while (i--) {
    let f = e[i];
    let u = f[0];
    let q = h[u.q];
    let D = u.x - q[0];
    let E = u.y - q[1];
    let G = M.sqrt((D * D) + (E * E));

    if (G < 10) {
      if (R() > .95) {
        u.q = ~~(R() * v);
      } else {
        if (R() > .99) u.D *= -1;
        u.q += u.D;
        u.q %= v;
        if (u.q < 0) u.q += v;
      }
    }

    u.X += -D / G * u.S;
    u.Y += -E / G * u.S;

    u.x += u.X;
    u.y += u.Y;

    render(u);

    u.X *= u.F;
    u.Y *= u.F;

    let k = 0;
    while (k < v - 1) {
      let T = f[k];
      let N = f[++k];

      N.x -= (N.x - T.x) * 0.7;
      N.y -= (N.y - T.y) * 0.7;

      render(N);
    }
  }

  // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∞–Ω—ñ–º–æ–≤–∞–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç—É
  animatedTexts = animatedTexts.filter(text => text.alpha > 0); // –í–∏–¥–∞–ª—è—î–º–æ —Ç–µ–∫—Å—Ç–∏, —â–æ –≤–∂–µ –∑–Ω–∏–∫–ª–∏

  animatedTexts.forEach(text => {
    text.x += text.speedX;
    text.y += text.speedY;
    text.alpha -= text.fadeSpeed; // –ó–º–µ–Ω—à—É—î–º–æ –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å

    renderText(text); // –ú–∞–ª—é—î–º–æ —Ç–µ–∫—Å—Ç
  });

  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ª—ñ–≤ "–õ–Æ–ë–õ–Æ"
  const loveCount = animatedTexts.filter(text => text.text === "–õ–Æ–ë–õ–Æ").length;
  if (loveCount >= 100) {
    // –í–∏–±–∏—Ä–∞—î–º–æ —Å–ª–æ–≤–æ –∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É –ø—ñ—Å–ª—è "–õ–Æ–ë–õ–Æ"
    const newText = alternateTextArray[alternateTextIndex];
    alternateTextIndex = (alternateTextIndex + 1) % alternateTextArray.length; // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω–¥–µ–∫—Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç—É

    // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–µ —Å–ª–æ–≤–æ –∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É
    const newTextObj = createText(O / 2, Q / 2, newText);
    animatedTexts.push(newTextObj);
  }
}

// –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—ñ–≤ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç—É
canvas.addEventListener('click', (e) => {
  const centerX = canvas.width / 2;
  const centerY = canvas.height / 2;

  // –ì–µ–Ω–µ—Ä—É—î–º–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –≤ –º–µ–∂–∞—Ö 500√ó500 –≤—ñ–¥ —Ü–µ–Ω—Ç—Ä—É
  const x = centerX + (R() * 100 - 100); // –í—ñ–¥ -250 –¥–æ +250
  const y = centerY + (R() * 400 - 200);

  // –ë–µ—Ä–µ–º–æ —Ç–µ–∫—Å—Ç –ø–æ –ø–æ—Ä—è–¥–∫—É, —è–∫—â–æ –¥—ñ–π—à–ª–∏ –¥–æ –∫—ñ–Ω—Ü—è –º–∞—Å–∏–≤—É, –ø–æ—á–∏–Ω–∞—î–º–æ –∑–Ω–æ–≤—É
  const text = textArray[textIndex];
  textIndex = (textIndex + 1) % textArray.length; // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω–¥–µ–∫—Å —Ç–µ–∫—Å—Ç—É

  // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π –∞–Ω—ñ–º–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç –≤ –º–∞—Å–∏–≤
  const newText = createText(x, y, text);
  animatedTexts.push(newText);
});

// –ó–∞–ø—É—Å–∫ –∞–Ω—ñ–º–∞—Ü—ñ—ó
function animate() {
  loop();
  requestAnimationFrame(animate);
}

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
animate();
